@page "/visualizar_agenda/{Id:int}"

@using fisioClin.Models
@inject AgendaDAO agendaDAO
@inject SalaDAO salaDAO
@inject FuncionariosDAO funcionariosDAO
@inject NavigationManager Nav

<PageTitle>Agenda</PageTitle>

@if (isLoading)
{
    <div class="loading-message">Carregando dados da agenda...</div>
}
else if (agenda == null)
{
    <div class="not-found-message">Agenda não encontrada. ID: @Id</div>
}
else
{
    <div class="agenda-details-container container mt-4">

        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a class="btn" href="/visualizaragenda">
                <i class="bi bi-arrow-left"></i> Voltar para Agenda
            </a>

            <h3 class="titulo mb-0">
                Detalhes da Agenda: <span class="text-id">ID @agenda.Id</span>
            </h3>
        </div>

        <!-- CARD PRINCIPAL -->
        <div class="form-section p-4 shadow-sm rounded">

            <h4 class="mb-4">Informações da Sessão</h4>

            <div class="row g-3">

                <div class="col-md-4">
                    <label class="form-label">Data</label>
                    <input type="text" class="form-control"
                           value="@agenda.Data?.ToString("dd/MM/yyyy")" readonly />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Horário</label>
                    <input type="text" class="form-control"
                           value="@agenda.Horario" readonly />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Sala</label>
                    <input type="text" class="form-control"
                           value="@nomeSala" readonly />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Fisioterapeuta</label>
                    <input type="text" class="form-control"
                           value="@nomeFisio" readonly />
                </div>

                <div class="col-12">
                    <label class="form-label">Observações</label>
                    <textarea class="form-control" rows="3" readonly>@agenda.Observacao</textarea>
                </div>

            </div>

            <div class="d-flex justify-content-end mt-4">
                <a class="btn btn-primary" href="/editar_agenda/@Id">
                    Editar Agenda
                </a>
            </div>

        </div>
    </div>
}

@code {
    [Parameter] public int Id { get; set; }

    private Agenda? agenda;
    private bool isLoading = true;

    private string nomeSala = "";
    private string nomeFisio = "";

    protected override void OnInitialized()
    {
        agenda = agendaDAO.BuscarPorId(Id);

        if (agenda != null)
        {
            var sala = salaDAO.BuscarPorId(agenda.Id_Sala_fk);
            nomeSala = sala?.Nome ?? "Não informado";

            var fisio = funcionariosDAO.BuscarPorId(agenda.Id_Funcionario_fk);
            nomeFisio = fisio?.Nome ?? "Não informado";
        }

        isLoading = false;
    }
}

<style>
    :root {
        --cor-principal: #6b0f0f;
        --cor-principal-hover: #8b0000;
        --cor-fundo-claro: #f7f5f5;
        --cor-texto: #333;
    }

    .titulo {
        font-weight: 600;
        color: var(--cor-texto);
    }

    .text-id {
        color: var(--cor-principal);
        font-weight: 700;
    }

    .form-section {
        background: white;
        border-radius: 10px;
    }

    .form-label {
        font-weight: 600;
        color: var(--cor-texto);
    }

    .btn-primary {
        background: var(--cor-principal);
        border: none;
    }

        .btn-primary:hover {
            background: var(--cor-principal-hover);
        }
</style>
