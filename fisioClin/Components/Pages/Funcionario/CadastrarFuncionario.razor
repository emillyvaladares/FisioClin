@page "/cadastrarfuncionario"
@using fisioClin.Models
@inject FuncionariosDAO funcionarioDAO
@using Microsoft.AspNetCore.Components.Forms
@using System.ComponentModel.DataAnnotations

@rendermode InteractiveServer

<main class="container my-4">

    <h2 class="text-maroon mb-4">Cadastrar Funcionário</h2>
    <section class="position-relative p-4 bg-white rounded shadow-sm">
        <EditForm Model="_novoFuncionario" OnValidSubmit="SalvarFuncionario" FormName="CadastrarFuncionarioForm">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="row g-3">

                <!-- NOME COMPLETO -->
                <div class="col-12 mb-3 position-relative">
                    <label for="nome" class="form-label">Nome completo</label>
                    <InputText id="nome" class="form-control" @bind-Value="_novoFuncionario.Nome" />
                    <ValidationMessage For="@(() => _novoFuncionario.Nome)" />
                </div>

                <!-- CPF -->
                <div class="col-md-4">
                    <label for="cpf" class="form-label">CPF</label>
                    <InputCpf id="cpf" class="form-control" @bind-Value="_novoFuncionario.Cpf" />
                    <ValidationMessage For="@(() => _novoFuncionario.Cpf)" />
                </div>

                <!-- RG -->
                <div class="col-md-4">
                    <label for="rg" class="form-label">RG</label>
                    <InputText id="rg" class="form-control" @bind-Value="_novoFuncionario.Rg" />
                    <ValidationMessage For="@(() => _novoFuncionario.Rg)" />
                </div>

                <!-- TIPO VÍNCULO -->
                <div class="col-md-4">
                    <label for="vinculo" class="form-label">Tipo de vínculo</label>
                    <InputSelect id="vinculo" class="form-select" @bind-Value="_novoFuncionario.TipoVinculo">
                        <option value="">Selecione</option>
                        <option>CLT</option>
                        <option>PJ</option>
                        <option>Estágio</option>
                    </InputSelect>
                    <ValidationMessage For="@(() => _novoFuncionario.TipoVinculo)" />
                </div>

                <!-- TELEFONE -->
                <div class="col-md-4">
                    <label for="telefone" class="form-label">Telefone</label>
                    <InputTelefone id="telefone" class="form-control" @bind-Value="_novoFuncionario.Telefone" />
                    <ValidationMessage For="@(() => _novoFuncionario.Telefone)" />
                </div>

                <!-- EMAIL -->
                <div class="col-md-4">
                    <label for="email" class="form-label">Email</label>
                    <InputText id="email" type="email" class="form-control" @bind-Value="_novoFuncionario.Email" />
                    <ValidationMessage For="@(() => _novoFuncionario.Email)" />
                </div>

                <!-- REGISTRO PROFISSIONAL -->
                <div class="col-md-4">
                    <label for="registro" class="form-label">Registro profissional</label>
                    <InputText id="registro" class="form-control" @bind-Value="_novoFuncionario.Registro" />
                    <ValidationMessage For="@(() => _novoFuncionario.Registro)" />
                </div>

                <!-- ESPECIALIDADE -->
                <div class="col-md-4">
                    <label for="especialidade" class="form-label">Especialidade</label>
                    <InputText id="especialidade" class="form-control" @bind-Value="_novoFuncionario.Especialidade" />
                    <ValidationMessage For="@(() => _novoFuncionario.Especialidade)" />
                </div>

                <!-- SUBESPECIALIDADE -->
                <div class="col-md-4">
                    <label for="subespecialidade" class="form-label">Subespecialidade</label>
                    <InputText id="subespecialidade" class="form-control" @bind-Value="_novoFuncionario.Subespecialidade" />
                    <ValidationMessage For="@(() => _novoFuncionario.Subespecialidade)" />
                </div>

                <!-- CERTIFICADOS (texto) -->
                <div class="col-md-4">
                    <label for="certificados" class="form-label">Certificados</label>
                    <InputText id="certificados" class="form-control" @bind-Value="_novoFuncionario.Certificados" />
                    <ValidationMessage For="@(() => _novoFuncionario.Certificados)" />
                </div>

                <!-- DATA NASCIMENTO -->
                <div class="col-md-3">
                    <label for="nascimento" class="form-label">Data de Nascimento</label>
                    <InputDate id="nascimento" class="form-control" @bind-Value="_novoFuncionario.DataNascimento" />
                    <ValidationMessage For="@(() => _novoFuncionario.DataNascimento)" />
                </div>

                <!-- DATA CONTRATAÇÃO -->
                <div class="col-md-3">
                    <label for="contratacao" class="form-label">Data de contratação</label>
                    <InputDate id="contratacao" class="form-control" @bind-Value="_novoFuncionario.DataContratacao" />
                    <ValidationMessage For="@(() => _novoFuncionario.DataContratacao)" />
                </div>

            </div>

            <div class="mt-4 d-flex gap-3">
                <button type="submit" class="btn btn-maroon">Cadastrar</button>
                <button type="reset" class="btn btn-secondary">Limpar</button>
            </div>

        </EditForm>
    </section>

    <ModalSucesso @ref="_modal" Mensagem="Funcionário cadastrado com sucesso!" />
</main>

@code {
    private Funcionarios _novoFuncionario = new();
    private ModalSucesso _modal;

    private async Task SalvarFuncionario()
    {
        try
        {
            // mesma lógica do cadastrarpaciente: deixar CPF só com dígitos
            if (!string.IsNullOrWhiteSpace(_novoFuncionario.Cpf))
                _novoFuncionario.Cpf = new string(_novoFuncionario.Cpf.Where(char.IsDigit).ToArray());

            // chama o DAO (mantive o mesmo nome do paciente: pacienteDAO -> funcionarioDAO)
            funcionarioDAO.Inserir(_novoFuncionario);

            // mostra modal de sucesso
            _modal.Mostrar();

            // limpa o model para resetar o formulário
            _novoFuncionario = new Funcionarios();
            StateHasChanged();

            // fecha o modal após 5 segundos (mesma lógica do paciente)
            await Task.Delay(5000);
            _modal.Fechar();
        }
        catch (Exception e)
        {
            Console.WriteLine(e.ToString());
        }
    }
}

<style>
    .text-maroon {
        color: #6b0010;
    }

    .btn-maroon {
        background-color: #8b0015;
        color: white;
        border: none;
    }

        .btn-maroon:hover, .btn-maroon:focus {
            background-color: #a3001c;
            color: white;
        }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
        border: none;
    }

        .btn-secondary:hover, .btn-secondary:focus {
            background-color: #5a6268;
            color: white;
        }
</style>
