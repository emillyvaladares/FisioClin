@page "/editar_cargo/{Id:int}"

@using fisioClin.Models
@inject CargoDAO cargoDAO
@inject NavigationManager NavManager
@using Microsoft.AspNetCore.Components.Forms
@using System.ComponentModel.DataAnnotations

@rendermode InteractiveServer

<main class="container my-4">
    <h2 class="text-maroon mb-4">Editar Cargo</h2>

    <section class="position-relative p-4 bg-white rounded shadow-sm">
        <EditForm Model="_cargo" OnValidSubmit="Atualizar" FormName="CargoForm">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="row g-3">
                <div class="col-12 mb-3">
                    <label class="form-label">Nome</label>
                    <InputText class="form-control" @bind-Value="_cargo.Nome" />
                    <ValidationMessage For="@(() => _cargo.Nome)" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Departamento</label>
                    <InputText class="form-control" @bind-Value="_cargo.Departamento" />
                    <ValidationMessage For="@(() => _cargo.Departamento)" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Carga horária (semanal)</label>
                    <InputNumber class="form-control" @bind-Value="_cargo.Carga" />
                    <ValidationMessage For="@(() => _cargo.Carga)" />
                </div>

                <div class="col-12">
                    <label class="form-label">Descrição do cargo</label>
                    <InputTextArea class="form-control" @bind-Value="_cargo.Descricao" rows="4" />
                    <ValidationMessage For="@(() => _cargo.Descricao)" />
                </div>

                <div class="col-12">
                    <label class="form-label">Observações</label>
                    <InputText class="form-control" @bind-Value="_cargo.Observacao" />
                    <ValidationMessage For="@(() => _cargo.Observacao)" />
                </div>
            </div>

            <div class="mt-4 d-flex gap-3">
                <button type="submit" class="btn bg-primary text-white">Atualizar</button>
            </div>

        </EditForm>
    </section>
</main>

@code {
    [Parameter]
    public int Id { get; set; }

    private Cargo _cargo = new Cargo();

    protected override void OnInitialized()
    {
        var cargoExistente = cargoDAO.BuscarPorId(Id);

        if (cargoExistente != null)
            _cargo = cargoExistente;
    }

    private void Atualizar()
    {
        _cargo.DataAtualizacao = DateTime.Now;

        cargoDAO.Atualizar(_cargo);

        NavManager.NavigateTo("/cargos");
    }
}
