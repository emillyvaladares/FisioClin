@page "/lista_paciente"
@using fisioClin.Models
@inject PacienteDAO pacienteDAO
@inject NavigationManager NavigationManager

@rendermode InteractiveServer

@code {
    private List<Paciente> pacientes = new();
    private string nomeBusca = "";

    protected override void OnInitialized()
    {
        AtualizarLista();
    }

    private void AtualizarLista()
    {
        pacientes = pacienteDAO.ListarTodos();
    }

    private void FiltrarPacientes()
    {
        var todos = pacienteDAO.ListarTodos();

        if (string.IsNullOrWhiteSpace(nomeBusca))
        {
            pacientes = todos;
        }
        else
        {
            pacientes = todos
                .Where(p => !string.IsNullOrEmpty(p.Nome) &&
                            p.Nome.Contains(nomeBusca, StringComparison.OrdinalIgnoreCase))
                .ToList();
        }
    }
}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-maroon fw-bold">Consultar Pacientes</h3>

        <a href="/cadastrarpaciente" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i> Cadastrar
        </a>
    </div>

    <!-- Barra de Pesquisa -->
    <div class="input-group mb-4 shadow-sm">
        <span class="input-group-text bg-white">
            <i class="bi bi-search"></i>
        </span>
        <input type="text"
               class="form-control"
               placeholder="Pesquisar Paciente"
               @bind="nomeBusca"
               @bind:event="oninput"
               @onkeyup="FiltrarPacientes" />
    </div>

    <!-- Tabela -->
    <div class="table-responsive shadow-sm rounded overflow-hidden">
        <table class="table table-striped table-hover align-middle mb-0">
            <thead class="header-agenda">
                <tr>
                    <th style="width:80px;">ID</th>
                    <th>Nome</th>
                    <th class="text-end" style="width:200px;">Ações</th>
                </tr>
            </thead>

            <tbody>
                @if (pacientes == null || pacientes.Count == 0)
                {
                    <tr>
                        <td colspan="3" class="text-center text-muted py-4">
                            Nenhum paciente encontrado.
                        </td>
                    </tr>
                }
                else
                {
                    @foreach (var p in pacientes)
                    {
                        <tr>
                            <td class="text-secondary">@p.Id</td>

                            <td style="padding:0;">
                                <a href="/dadospaciente/@p.Id"
                                   class="text-decoration-none text-dark fw-semibold d-block px-2 py-2">
                                    @p.Nome
                                </a>
                            </td>

                            <td class="text-end">

                                <a class="btn btn-warning btn-sm me-2"
                                   href="/editarpaciente/@p.Id">
                                    <i class="bi bi-pencil-square"></i>
                                </a>

                                <a class="btn btn-danger btn-sm"
                                   href="/excluirpaciente/@p.Id">
                                    <i class="bi bi-trash"></i>
                                </a>

                            </td>
                        </tr>

                    }
                }
            </tbody>
        </table>
    </div>

</div>

<style>
    :root {
        --cor-principal: #6b0f0f;
    }

    .header-agenda {
        background-color: var(--cor-principal);
        color: #fff;
    }

    .text-maroon {
        color: var(--cor-principal);
    }
</style>
