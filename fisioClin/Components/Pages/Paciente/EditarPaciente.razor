@page "/editarpaciente/{Id:int}"
@using fisioClin.Models
@inject PacienteDAO pacienteDAO
@inject NavigationManager nav
@using Microsoft.AspNetCore.Components.Forms

@rendermode InteractiveServer

<main class="container my-4">

    <h2 class="text-maroon mb-4">Editar Paciente</h2>

    <section class="position-relative p-4 bg-white rounded shadow-sm">
        <EditForm Model="_paciente" OnValidSubmit="Salvar" FormName="EditarPacienteForm">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="row g-3">

                <!-- (todos os mesmos campos do cadastro) -->

                <div class="col-12 mb-3">
                    <label class="form-label">Nome completo</label>
                    <InputText class="form-control" @bind-Value="_paciente.Nome" />
                    <ValidationMessage For="@(() => _paciente.Nome)" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">CPF</label>
                    <InputCpf class="form-control" @bind-Value="_paciente.Cpf" />
                    <ValidationMessage For="@(() => _paciente.Cpf)" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">CEP</label>
                    <InputText class="form-control" @bind-Value="_paciente.Cep" />
                    <ValidationMessage For="@(() => _paciente.Cep)" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">RG</label>
                    <InputText class="form-control" @bind-Value="_paciente.Rg" />
                    <ValidationMessage For="@(() => _paciente.Rg)" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Bairro</label>
                    <InputText class="form-control" @bind-Value="_paciente.Bairro" />
                    <ValidationMessage For="@(() => _paciente.Bairro)" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Data de Nascimento</label>
                    <InputDate class="form-control" @bind-Value="_paciente.DataNascimento" />
                    <ValidationMessage For="@(() => _paciente.DataNascimento)" />
                </div>

                <div class="col-md-4">
                    <label class="form-label">Rua</label>
                    <InputText class="form-control" @bind-Value="_paciente.Rua" />
                    <ValidationMessage For="@(() => _paciente.Rua)" />
                </div>

                <div class="col-md-3">
                    <label class="form-label">Número</label>
                    <InputText class="form-control" @bind-Value="_paciente.Numero" />
                    <ValidationMessage For="@(() => _paciente.Numero)" />
                </div>

                <div class="col-md-3">
                    <label class="form-label">Sexo</label>
                    <InputSelect class="form-select" @bind-Value="_paciente.Sexo">
                        <option value="">Selecione</option>
                        <option>Masculino</option>
                        <option>Feminino</option>
                        <option>Outro</option>
                    </InputSelect>
                    <ValidationMessage For="@(() => _paciente.Sexo)" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Email</label>
                    <InputText type="email" class="form-control" @bind-Value="_paciente.Email" />
                    <ValidationMessage For="@(() => _paciente.Email)" />
                </div>

                <div class="col-md-6">
                    <label class="form-label">Telefone</label>
                    <InputTelefone type="tel" class="form-control" @bind-Value="_paciente.Telefone" />
                    <ValidationMessage For="@(() => _paciente.Telefone)" />
                </div>

            </div>

            <div class="mt-4 d-flex gap-3">
                <button type="submit" class="btn btn-maroon">Atualizar</button>
                <button type="button" class="btn btn-secondary" @onclick="Voltar">Cancelar</button>
            </div>

        </EditForm>
    </section>

    <ModalSucesso @ref="_modal" Mensagem="Paciente atualizado com sucesso!" />

</main>

@code {
    [Parameter] public int Id { get; set; }

    private Paciente _paciente = new();
    private ModalSucesso _modal;

    protected override void OnInitialized()
    {
        _paciente = pacienteDAO.BuscarPorId(Id);
    }

    private async Task Salvar()
    {
        try
        {
            _paciente.Cpf = new string(_paciente.Cpf.Where(char.IsDigit).ToArray());

            pacienteDAO.Atualizar(_paciente);

            _modal.Mensagem = "Paciente atualizado com sucesso!";
            _modal.Mostrar();

            await Task.Delay(2000);
            _modal.Fechar();
            Voltar();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
        }
    }

    private void Voltar()
    {
        nav.NavigateTo("/lista_paciente");
    }
}

<style>
    .text-maroon {
        color: #6b0010;
    }

    .btn-maroon {
        background-color: #8b0015;
        color: white;
        border: none;
    }

        .btn-maroon:hover {
            background-color: #a3001c;
        }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }
</style>
